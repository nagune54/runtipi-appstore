{
  "services": {
    "yamtrack": {
      "container_name": "{{APP_ID}}",
      "image": "{{APP_IMAGE}}",
      "restart": "on-failure:5",
      "mem_limit": "2g",
      "security_opt": [
        "no-new-privileges:true"
      ],
      "ports": [
        "{{APP_PORT}}:8000"
      ],
      "volumes": [
        "{{APP_DATA_DIR}}/db:/app/data"
      ],
      "environment": {
        "SECRET": "{{YAMTRACK_SECRET}}",
        "REDIS_URL": "redis://redis:6379",
        "TMDB_NSFW": "{{TMDB_NSFW}}",
        "MAL_NSFW": "{{MAL_NSFW}}",
        "TZ": "{{TZ}}",
        "TMDB_API": "{{TMDB_API_KEY}}",
        "MAL_API": "{{MAL_API_KEY}}"
      },
      "depends_on": {
          "redis": {
              "condition": "service_healthy"
          }
      },
      "healthcheck": {
        "test": ["CMD-SHELL", "nc -z 127.0.0.1 8000 || exit 1"],
        "interval": "10s",
        "timeout": "5s",
        "retries": 3,
        "start_period": "90s"
      }
    },
    "redis": {
      "container_name": "{{APP_ID}}-redis",
      "image": "redis:7-alpine",
      "restart": "on-failure:5",
      "volumes": [
        "{{APP_DATA_DIR}}/redis:/data"
      ],
      "healthcheck": {
        "test": ["CMD-SHELL", "redis-cli ping || exit 1"],
        "interval": "10s",
        "timeout": "5s",
        "retries": 3
      }
    }
  }
}